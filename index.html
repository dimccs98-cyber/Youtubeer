<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Video Player</title>
    <style>
        /* --- 1. 全局布局 --- */
        * { box-sizing: border-box; }
        html, body { 
            margin: 0; padding: 0; 
            background-color: #000000; /* 背景设为黑色，作为视频底色 */
            color: #333333; 
            font-family: -apple-system, BlinkMacSystemFont, "PingFang SC", "Helvetica Neue", Arial, sans-serif; 
            height: 100%; width: 100%; 
            overflow: hidden; 
        }
        
        body {
            display: flex;
            flex-direction: column; 
        }

        /* --- 2. 视频区域 --- */
        .video-container { 
            position: relative;
            width: 100%; 
            padding-bottom: 56.25%; /* 16:9 */
            height: 0;
            background: #000; 
            z-index: 50; 
            flex-shrink: 0; 
        }
        
        .video-container iframe { 
            position: absolute; top: 0; left: 0; width: 100%; height: 100%; border: none; 
        }

        /* --- 3. 内容滚动区域 (过渡核心) --- */
        .content-scroll-area {
            flex: 1; 
            overflow-y: auto; 
            -webkit-overflow-scrolling: touch; 
            position: relative;
            z-index: 100;
            
            /* 关键设计：向上重叠并设置大圆角 */
            margin-top: -24px; 
            background-color: #F3F2EE;
            border-radius: 24px 24px 0 0;
            
            /* 添加极其柔和的向上阴影，增强层次感 */
            box-shadow: 0 -8px 24px rgba(0,0,0,0.15);
            
            padding: 0 24px 100px 24px;
        }

        /* 装饰把手：增加“面板”感 */
        .handle-bar {
            width: 36px;
            height: 4px;
            background-color: #D1D1D1;
            border-radius: 2px;
            margin: 12px auto 20px auto;
        }

        /* --- 4. 视频概况排版 --- */
        .summary-header {
            display: flex;
            align-items: center;
            margin-bottom: 20px;
        }

        .summary-icon {
            width: 22px;
            height: 22px;
            margin-right: 8px;
            fill: #FFD700;
        }

        .title { 
            font-size: 19px; 
            font-weight: 800; 
            color: #1a1a1a; 
            margin: 0;
            letter-spacing: 0.5px;
            position: relative;
        }

        /* 金色点缀小方块代替长线条，更显精致 */
        .title::before {
            content: "";
            position: absolute;
            left: -12px;
            top: 50%;
            transform: translateY(-50%);
            width: 4px;
            height: 16px;
            background-color: #FFD700;
            border-radius: 2px;
        }

        .text-container {
            animation: fadeIn 0.6s ease-out;
        }

        .text { 
            font-size: 15.5px; 
            line-height: 1.85; 
            color: #444444; 
            word-wrap: break-word; 
            white-space: pre-wrap; 
            text-align: justify;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(8px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* --- 5. 登录/错误遮罩 --- */
        #login-layer {
            display: none; 
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            background-color: rgba(0,0,0,0.85);
            backdrop-filter: blur(5px);
            z-index: 150; 
            flex-direction: column; justify-content: center; align-items: center;
            text-align: center;
            padding: 20px;
        }
        
        #login-msg { color: #fff; font-size: 14px; margin-bottom: 20px; line-height: 1.6; }

        #login-btn {
            background-color: #FFD700; 
            color: #000; 
            padding: 12px 32px; 
            text-decoration: none; 
            border-radius: 24px; 
            font-size: 14px;
            font-weight: 700; 
            box-shadow: 0 4px 12px rgba(255, 215, 0, 0.2);
        }

        .login-tip { font-size: 12px; color: #888; margin-top: 15px; }
        
        .loader {
            display: flex; justify-content: center; align-items: center;
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            color: #666; font-size: 13px; z-index: 40; background: #000;
        }
    </style>
</head>
<body>

    <!-- 视频区域保持不变 -->
    <div class="video-container">
        <div class="loader" id="loader">同步视频资源...</div>
        <div id="player"></div>
        
        <div id="login-layer">
            <div id="login-msg">当前内容受限<br>请验证 YouTube 身份后继续</div>
            <a id="login-btn" href="https://m.youtube.com" target="_self">立即验证</a>
            <div class="login-tip">登录成功后，请按手机 <b>返回键</b> 重载此页</div>
        </div>
    </div>

    <!-- 滚动区域：增加 handle-bar 过渡元素 -->
    <div class="content-scroll-area">
        <div class="handle-bar"></div>
        
        <div class="summary-header">
            <svg class="summary-icon" viewBox="0 0 24 24">
                <path d="M14 2H6c-1.1 0-1.99.9-1.99 2L4 20c0 1.1.89 2 1.99 2H18c1.1 0 2-.9 2-2V8l-6-6zm2 16H8v-2h8v2zm0-4H8v-2h8v2zm-3-5V3.5L18.5 9H13z"/>
            </svg>
            <h2 class="title">视频概况</h2>
        </div>
        
        <div class="text-container">
            <div class="text" id="quote-text">
                <span style="color: #999; font-style: italic;">正在获取摘要详情...</span>
            </div>
        </div>
    </div>

    <script>
        // JS 逻辑保持完全一致，确保 Base64 注入和 API 功能正常
        window.updateContent = function(base64Text) {
            try {
                const binaryString = atob(base64Text);
                const bytes = new Uint8Array(binaryString.length);
                for (let i = 0; i < binaryString.length; i++) {
                    bytes[i] = binaryString.charCodeAt(i);
                }
                const decodedText = new TextDecoder().decode(bytes);
                document.getElementById('quote-text').innerText = decodedText;
            } catch(e) {
                console.error("Injection failed", e);
            }
        };

        try {
            const urlParams = new URLSearchParams(window.location.search);
            const videoId = urlParams.get('v') || urlParams.get('videoId');
            const quoteTextRaw = urlParams.get('text');
            
            if (quoteTextRaw && quoteTextRaw !== "null") {
                try {
                    document.getElementById('quote-text').innerText = decodeURIComponent(quoteTextRaw);
                } catch (e) {
                    document.getElementById('quote-text').innerText = quoteTextRaw;
                }
            }

            if (videoId) {
                var tag = document.createElement('script');
                tag.src = "https://www.youtube.com/iframe_api";
                var firstScriptTag = document.getElementsByTagName('script')[0];
                firstScriptTag.parentNode.insertBefore(tag, firstScriptTag);

                var player;
                window.onYouTubeIframeAPIReady = function() {
                    player = new YT.Player('player', {
                        height: '100%', width: '100%', videoId: videoId,
                        host: 'https://www.youtube.com',
                        playerVars: {
                            'autoplay': 1, 'controls': 1, 'playsinline': 1, 'fs': 1, 'rel': 0, 'modestbranding': 1,
                            'origin': window.location.origin
                        },
                        events: {
                            'onReady': function(event) {
                                document.getElementById('loader').style.display = 'none';
                                event.target.unMute(); 
                                event.target.playVideo();
                            },
                            'onError': function(event) {
                                document.getElementById('loader').style.display = 'none';
                                if ([150, 101, 152, 5].indexOf(event.data) !== -1) {
                                    showLoginLayer();
                                }
                            }
                        }
                    });
                };
            }
        } catch (e) {
            document.getElementById('quote-text').innerText = "加载失败";
        }

        function showLoginLayer() {
            document.getElementById('login-layer').style.display = 'flex';
            var iframe = document.querySelector('#player iframe');
            if(iframe) iframe.style.visibility = 'hidden';
        }
    </script>
</body>
</html>
